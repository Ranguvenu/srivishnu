define(["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","core/templates","local_program/select2","local_program/program"],function(t,o,e,a,n,i,c,r,l,s){curriculumlastchildpopup=function(n){t.ajax({type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:{curriculumid:n.id,action:"curriculumlastchildpopup",sesskey:M.cfg.sesskey},success:function(n){e.create({title:o.get_string("curriculum_info","local_program"),body:n}).done(function(o){o.show(),o.setLarge(),o.getRoot().addClass("openLMStransition"),o.getRoot().animate({right:"0%"},500),o.getRoot().on(a.hidden,function(){o.destroy()}.bind(this)),t(".close").click(function(){window.location.href=window.location.href})})}})};var u=function(t){this.contextid=t.contextid,this.args=t,this.init(t)};return u.prototype.modal=null,u.prototype.contextid=-1,u.prototype.init=function(n){var i=this;switch(n.callback){case"program_form":switch(n.id){case 0:header_label="createcurriculum";break;default:header_label="updatecurriculum"}break;case"session_form":switch(n.id){case 0:header_label="addsession";break;default:header_label="updatesession"}break;case"curriculum_manageclassroom_form":switch(n.id){case 0:header_label="addclassroom";break;default:header_label="updateclassroom"}break;case"course_form":switch(n.id){case 0:header_label="addcourses";break;default:header_label="updatecourses"}break;case"program_manageprogram_form":switch(n.id){case 0:header_label="addprogram";break;default:header_label="updateprogram"}break;case"curriculum_completion_form":header_label="curriculum_completion_settings";break;case"curriculum_managesemester_form":switch(n.id){case 0:header_label="addsemester";break;default:header_label="updatesemester"}break;case"curriculum_manageyear_form":switch(n.id){case 0:header_label="addyear";break;default:header_label="updateyear"}break;case"course_form":header_label="addcourse";break;case"curriculum_managefaculty_form":header_label="addfaculty";break;case"curriculum_managestudent_form":header_label="addstudent";break;case"curriculum_setyearcost_form":header_label="setcost";break;case"classroom_completion_form":switch(n.id){case 0:header_label="classroom_completion_settings";break;default:header_label="updateclassroom_completion_settings"}}return o.get_string(header_label,"local_program").then(function(t){return e.create({type:e.types.DEFAULT,title:t,body:this.getBody(),footer:this.getFooter()})}.bind(this)).then(function(o){return this.modal=o,this.modal.setLarge(),this.modal.getRoot().addClass("openLMStransition local_curriculum"),this.modal.getRoot().on(a.hidden,function(){o.destroy()}.bind(this)),this.modal.getFooter().find('[data-action="save"]').on("click",this.submitForm.bind(this)),this.modal.getFooter().find('[data-action="cancel"]').on("click",function(){window.location.href=window.location.href}),this.modal.getFooter().find('[data-action="skip"]').on("click",function(){i.args.form_status=i.args.form_status+1,n.callback;var e=i.getBody();e.then(function(o,e){!1===o&&(i.handleFormSubmissionResponse(n),t("#viewcurriculums").dataTable({language:{emptyTable:"No Programs available in table",paginate:{previous:"<",next:">"}},bInfo:!1}).destroy(),s.Datatable())}),o.setBody(e)}),this.modal.getRoot().on("submit","form",function(t){i.submitFormAjax(t,i.args)}),this.modal.show(),this.modal.getRoot().animate({right:"0%"},500),t(".close").click(function(){window.location.href=window.location.href}),this.modal}.bind(this))},u.prototype.getBody=function(t){return void 0===t&&(t={}),this.args.jsonformdata=JSON.stringify(t),n.loadFragment(this.args.component,this.args.callback,this.contextid,this.args)},u.prototype.getFooter=function(){return"curriculum_managefaculty_form"==this.args.callback||"curriculum_managestudent_form"==this.args.callback?$footer='<button type="button" class="btn btn-primary" data-action="save">Assign</button>&nbsp;':(this.args.id?$footer='<button type="button" class="btn btn-primary" data-action="save">Update</button>&nbsp;':$footer='<button type="button" class="btn btn-primary" data-action="save">Create</button>&nbsp;',0==this.form_status&&($style='style="display:none;"',$footer+='<button type="button" class="btn btn-secondary" data-action="skip" '+$style+">Skip</button>&nbsp;")),$footer+='<button type="button" class="btn btn-secondary" data-action="cancel">Cancel</button>',$footer},u.prototype.handleFormSubmissionResponse=function(o){this.modal.hide(),c.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),(o.form_status<0||!1===o.form_status)&&("program_program"==o.pluginname||"program_addyear"==o.pluginname||"program"==o.pluginname||"addfaculty"==o.pluginname||"addstudent"==o.pluginname||"session"==o.pluginname||"classroom_completion_settings"==o.pluginname?window.location.reload():t.ajax({method:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:{action:"curriculumyearsemesters",curriculumid:o.curriculumid,yearid:o.yearid},success:function(o){t(".yearstabscontent_container").html(o)}}))},u.prototype.handleFormSubmissionFailure=function(t){this.modal.setBody(this.getBody(t))},u.prototype.submitFormAjax=function(o,e){o.preventDefault();var a=this,n=this.modal.getRoot().find("form").serialize(),c=e.plugintype+"_"+e.pluginname+"_submit_instance",r={};r.contextid=this.contextid,r.jsonformdata=JSON.stringify(n),r.form_status=e.form_status,i.call([{methodname:c,args:r}])[0].done(function(o){a.args.form_status=o.form_status,o.form_status>=0&&!1!==o.form_status?(a.args.form_status=o.form_status,a.args.id=o.id,a.handleFormSubmissionFailure()):(a.args.id=o.id,a.handleFormSubmissionResponse(a.args)),e.form_status>0&&t('[data-action="skip"]').css("display","inline-block")}).fail(function(t){a.handleFormSubmissionFailure(n)})},u.prototype.submitForm=function(t){t.preventDefault(),this.modal.getRoot().find("form").submit()},ajaxforms={course_switch:function(o){if(t("#switch_course_"+o.courseid).is(":checked")){var e=1;checkbox_value=t("#switch_course_"+o.courseid).val()}else{e=0;checkbox_value=t("#switch_course_"+o.courseid).val()}t.ajax({type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php?course="+checkbox_value+"&switch_type="+e,data:{action:""},success:function(o){1==e?t("#notifycompletion"+checkbox_value).show():t("#notifycompletion"+checkbox_value).hide()},error:function(){},complete:function(){}})},init:function(t){return new u(t)},load:function(){t(document).on("change","#id_costcenter",function(){var o=t(this).find("option:selected").val();null!==o&&t.ajax({method:"GET",dataType:"json",url:M.cfg.wwwroot+"/local/program/ajax.php?action=roomlocation&costcenter="+o,success:function(o){var e="<option value = 0>--Select Location--</option>";t.each(o.data,function(t,o){e+="<option value = "+o.id+" >"+o.fullname+"</option>"}),t("#id_location").html(e)}})}),t(document).on("change","#id_location",function(){var o=t(this).find("option:selected").val();null!==o&&t.ajax({method:"GET",dataType:"json",url:M.cfg.wwwroot+"/local/program/ajax.php?action=findroom&location="+o,success:function(o){var e="<option value = 0>--Select Room--</option>";t.each(o.data,function(t,o){e+="<option value = "+o.id+" >"+o.name+"</option>"}),t("#id_room").html(e)}})}),t(document).on("change","#id_costcenter",function(){var o=t(this).find("option:selected").val();null!==o&&t.ajax({method:"GET",dataType:"json",url:M.cfg.wwwroot+"/local/program/ajax.php?action=faculties&costcenter="+o,success:function(o){var e="<option value = 0>--Select Faculty--</option>";t.each(o.data,function(t,o){e+="<option value = "+o.id+" >"+o.fullname+"</option>"}),t("#id_faculty").html(e)}})}),t(document).on("change","#id_costcenter",function(){var o=t(this).find("option:selected").val();null!==o&&t.ajax({method:"GET",dataType:"json",url:M.cfg.wwwroot+"/local/users/ajax.php?action=departmentlist&costcenter="+o,success:function(o){var e="<option value= >--Select College--</option>";t.each(o.colleges,function(t,o){e+="<option value = "+o.id+" >"+o.fullname+"</option>"}),t("#id_open_collegeid").html(e);var a="<option value=0>--Select Department--</option>";t.each(o.departments,function(t,o){a+="<option value = "+o.id+" >"+o.fullname+"</option>"}),t("#id_departmentid").html(a);t("#id_curriculumid").html("<option value = 0>Select Curriculum</option>")}})}),t(document).on("change","#id_open_collegeid",function(){var o=t(this).find("option:selected").val(),e=t("#id_costcenter").val();if(null!==o&&0!=o)t.ajax({method:"GET",dataType:"json",url:M.cfg.wwwroot+"/local/program/ajax.php?action=deptcurriculums&costcenter="+e+"&department="+o,success:function(o){var e="<option value = 0>Select Curriculum</option>";t.each(o.curriculums,function(t,o){e+="<option value = "+o.id+" >"+o.name+"</option>"}),t("#id_curriculumid").html(e)}});else{t("#id_curriculumid").html("<option value = 0>Select Curriculum</option>")}}),t(document).on("change","#id_departmentid",function(){var o=t(this).find("option:selected").val(),e=t("#id_costcenter").val();if(null!==o&&0!=o)t.ajax({method:"GET",dataType:"json",url:M.cfg.wwwroot+"/local/program/ajax.php?action=deptcurriculums&costcenter="+e+"&department="+o,success:function(o){var e="<option value = 0>Select Curriculum</option>";t.each(o.curriculums,function(t,o){e+="<option value = "+o.id+" >"+o.name+"</option>"}),t("#id_curriculumid").html(e)}});else{t("#id_curriculumid").html("<option value = 0>Select Curriculum</option>")}}),t(document).on("click","#id_institute_type_1",function(){var o=t("input[name='institute_type']:checked").val(),e=t("input[name=programid]").val();null!==o&&t.ajax({method:"GET",dataType:"json",url:M.cfg.wwwroot+"/local/program/ajax.php?action=displaylocations&locationvalue="+o+"&programid="+e,success:function(o){var e="<option value>--Select Location--</option>";t.each(o.data,function(t,o){e+="<option value = "+o.id+" >"+o.fullname+"</option>"}),t("#id_instituteid").html(e),t("#id_room").html("<option value>--Select Room--</option>")}})}),t(document).on("click","#id_institute_type_2",function(){var o=t("input[name='institute_type']:checked").val(),e=t("input[name=programid]").val();null!==o&&t.ajax({method:"GET",dataType:"json",url:M.cfg.wwwroot+"/local/program/ajax.php?action=displaylocations&locationvalue="+o+"&programid="+e,success:function(o){var e="<option value>--Select Location--</option>";t.each(o.data,function(t,o){e+="<option value = "+o.id+" >"+o.fullname+"</option>"}),t("#id_instituteid").html(e),t("#id_room").html("<option value>--Select Room--</option>")}})}),t(document).on("click","#id_instituteid",function(){var o=t(this).find("option:selected").val();null!==o&&t.ajax({method:"GET",dataType:"json",url:M.cfg.wwwroot+"/local/program/ajax.php?action=findroom&location="+o,success:function(o){var e="<option value>--Select Room--</option>";t.each(o.data,function(t,o){e+="<option value = "+o.id+" >"+o.name+"</option>"}),t("#id_room").html(e)}})})},myDescFunction:function(){var t=document.getElementById("descriptiondotsBtn"),o=document.getElementById("resttextDisplay"),e=document.getElementById("readmoremyBtn");"none"===t.style.display?(t.style.display="inline",e.innerHTML="Read more",o.style.display="none"):(t.style.display="none",e.innerHTML="Read less",o.style.display="inline")}}});