define(["local_mooccourses/jquery.dataTables","jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui"],function(t,o,e,s,i,n,a,r){var c=function(t){this.contextid=t.context,this.id=t.id;this.args=t,this.init(t)};return c.prototype.modal=null,c.prototype.contextid=-1,c.prototype.init=function(t){console.log(t);var n=this;if(2==t.course)var a=e.get_string("edituser","local_mooccourses");if(1==t.course)a=e.get_string("selectcategory","local_mooccourses");if(3==t.course)a=e.get_string("edithead","local_mooccourses");if(1==t.act)a=e.get_string("create_newstudent","local_mooccourses");return a.then(function(t){return s.create({type:s.types.DEFAULT,title:t,body:this.getBody(),footer:this.getFooter()})}.bind(this)).then(function(t){return n.modal=t,n.modal.getRoot().addClass("openLMStransition local_school"),n.modal.setLarge(),this.modal.getRoot().on(i.hidden,function(){t.destroy()}.bind(this)),this.modal.getFooter().find('[data-action="save"]').on("click",this.submitForm.bind(this)),this.modal.getFooter().find('[data-action="cancel"]').on("click",function(){window.location.href=window.location.href}),this.modal.getFooter().find('[data-action="skip"]').on("click",function(){n.args.form_status=n.args.form_status+1;var o=n.getBody();t.setBody(o)}),this.modal.getRoot().on("submit","form",function(t){n.submitFormAjax(t,n.args)}),this.modal.show(),this.modal.getRoot().animate({right:"0%"},500),o(".close").click(function(){window.location.href=window.location.href}),this.modal}.bind(this))},c.prototype.getBody=function(t){return void 0===t&&(t={}),this.args.jsonformdata=JSON.stringify(t),this.args.act?n.loadFragment("local_mooccourses","enroluser",this.args.context,this.args):this.args.courseid?n.loadFragment("local_mooccourses","selectcategory",this.args.contextid,this.args):n.loadFragment("local_mooccourses","selectcategory",this.contextid,this.args)},c.prototype.getFooter=function(){return 3==this.args.course?$footer='<button type="button" class="btn btn-primary" data-action="save">Update</button>&nbsp;':1==this.args.act?$footer='<button type="button" class="btn btn-primary" data-action="save">Assign</button>&nbsp;':$footer='<button type="button" class="btn btn-primary" data-action="save">Create</button>&nbsp;',0==this.form_status&&($style='style="display:none;"',$footer+='<button type="button" class="btn btn-secondary" data-action="skip" '+$style+">Skip</button>&nbsp;"),$footer+='<button type="button" class="btn btn-secondary" data-action="cancel">Cancel</button>',$footer},c.prototype.handleFormSubmissionResponse=function(){this.modal.hide(),r.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),document.location.reload()},c.prototype.handleFormSubmissionFailure=function(t){this.modal.setBody(this.getBody(t))},c.prototype.submitFormAjax=function(t){t.preventDefault();var o=this.modal.getRoot().find("form").serialize();this.args.cid?a.call([{methodname:"local_mooccourses_submit_create_mooccourse_form",args:{contextid:this.contextid,courseid:this.args.courseid,parentcourseid:this.args.cid,jsonformdata:JSON.stringify(o)},done:this.handleFormSubmissionResponse.bind(this,o),fail:this.handleFormSubmissionFailure.bind(this,o)}]):1==this.args.act?a.call([{methodname:"local_mooccourses_submit_enrolusers_form",args:{contextid:this.contextid,courseid:this.args.courseid,jsonformdata:JSON.stringify(o)},done:this.handleFormSubmissionResponse.bind(this,o),fail:this.handleFormSubmissionFailure.bind(this,o)}]):a.call([{methodname:"local_mooccourses_submit_edit_mooccourse_form",args:{contextid:this.args.contextid,courseid:this.args.courseid,forpurchaseindividually:this.args.forpurchaseindividually,jsonformdata:JSON.stringify(o)},done:this.handleFormSubmissionResponse.bind(this,o),fail:this.handleFormSubmissionFailure.bind(this,o)}])},c.prototype.submitForm=function(t){t.preventDefault();this.modal.getRoot().find("form").submit()},{init:function(t){return new c(t)},load:function(){o(document).on("change","#id_open_costcenterid",function(){var t=o(this).find("option:selected").val();null!==t&&o.ajax({method:"GET",dataType:"json",url:M.cfg.wwwroot+"/local/curriculum/ajax.php?action=departmentlist&costcenter="+t,success:function(t){var e="<option value=>--Select College--</option>";o.each(t.colleges,function(t,o){e+="<option value = "+o.id+" >"+o.fullname+"</option>"}),o("#id_open_collegeid").html(e);var s="<option value=0>--Select Department--</option>";o.each(t.departments,function(t,o){s+="<option value = "+o.id+" >"+o.fullname+"</option>"}),o("#id_open_departmentid").html(s)}})})},mooccoursesList:function(t){var n=this;o.ajax({type:"POST",data:{action:"mooccoursesList",sesskey:M.cfg.sesskey},success:function(t){s.create({title:e.get_string("selecttemplate","local_mooccourses"),body:t}).done(function(t){t.setLarge(),t.getRoot().addClass("openLMStransition"),t.getRoot().animate({right:"0%"},500),t.getRoot().on(i.hidden,function(){t.destroy()}.bind(this)),t.getRoot().on(i.cancel,function(){t.hide(),t.destroy()}.bind(this)),t.show(),n.dataTableshow()})}})}}});