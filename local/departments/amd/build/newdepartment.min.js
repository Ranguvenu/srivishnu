define ("local_departments/newdepartment",["local_courses/jquery.dataTables","jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui"],function(a,b,c,d,e,f,g,h){var i=function(a,b,c,d){this.contextid=b;this.categoryid=c;this.underuniversity=d;var e=this;e.init(a)};i.prototype.modal=null;i.prototype.contextid=-1;i.prototype.init=function(){var a=this;if(a.categoryid){var f=c.get_string("editdepartment","local_departments")}else{var f=c.get_string("adddepartment","local_departments")}return f.then(function(b){return d.create({type:d.types.DEFAULT,title:b,body:a.getBody(),footer:this.getFooter()})}.bind(a)).then(function(c){a.modal=c;a.modal.getRoot().addClass("openLMStransition local_school");a.modal.setLarge();this.modal.getRoot().on(e.hidden,function(){c.destroy()}.bind(this));this.modal.getFooter().find("[data-action=\"save\"]").on("click",this.submitForm.bind(this));this.modal.getFooter().find("[data-action=\"cancel\"]").on("click",function(){window.location.href=window.location.href});this.modal.getFooter().find("[data-action=\"skip\"]").on("click",function(){a.args.form_status=a.args.form_status+1;var b=a.getBody();c.setBody(b)});this.modal.getRoot().on("submit","form",function(b){a.submitFormAjax(b,a.args)});this.modal.show();this.modal.getRoot().animate({right:"0%"},500);b(".close").click(function(){window.location.href=window.location.href});return this.modal}.bind(this))};i.prototype.getBody=function(a){if("undefined"==typeof a){a={}}params={};params.jsonformdata=JSON.stringify(a);params.categoryid=this.categoryid;params.underuniversity=this.underuniversity;return f.loadFragment("local_courses","department_form",this.contextid,params)};i.prototype.getFooter=function(){console.log(this);if(this.categoryid){$footer="<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">Update</button>&nbsp;"}else{$footer="<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">Create</button>&nbsp;"}if(0==this.form_status){$style="style=\"display:none;\"";$footer+="<button type=\"button\" class=\"btn btn-secondary\" data-action=\"skip\" "+$style+">Skip</button>&nbsp;"}$footer+="<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">Cancel</button>";return $footer};i.prototype.handleFormSubmissionResponse=function(){this.modal.hide();h.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()});document.location.reload()};i.prototype.handleFormSubmissionFailure=function(a){this.modal.setBody(this.getBody(a))};i.prototype.submitFormAjax=function(a){a.preventDefault();var b=this.modal.getRoot().find("form").serialize();console.log(JSON.stringify(b));g.call([{methodname:"local_courses_submit_create_department_form",args:{contextid:this.contextid,jsonformdata:JSON.stringify(b)},done:this.handleFormSubmissionResponse.bind(this,b),fail:this.handleFormSubmissionFailure.bind(this,b)}])};i.prototype.submitForm=function(a){a.preventDefault();var b=this;b.modal.getRoot().find("form").submit()};return{init:function init(a){return new i(a.selector,a.contextid,a.categoryid,a.underuniversity)},catgoriesTableDatatable:function catgoriesTableDatatable(){b("#category_tbl").dataTable({searching:!0,bLengthChange:!1,lengthChange:!1,lengthMenu:[5,10,25,50,-1],aaSorting:[],language:{emptyTable:"No Records Found",paginate:{previous:"<",next:">"}}})},load:function load(){},deleteConfirm:function deleteConfirm(a){console.log(a);return c.get_strings([{key:"confirm"},{key:"deleteconfirm",component:"local_users",param:a},{key:"deleteallconfirm",component:"local_users"},{key:"delete"}]).then(function(b){d.create({title:b[0],type:d.types.SAVE_CANCEL,body:b[1]}).done(function(c){this.modal=c;c.setSaveButtonText(b[3]);c.getRoot().on(e.save,function(b){b.preventDefault();a.confirm=!0;console.log(a);var c={id:a.id,contextid:a.contextid},d=g.call([{methodname:"local_users_"+a.action,args:c}]);d[0].done(function(){window.location.href=window.location.href}).fail(function(a){console.log(a)})}.bind(this));c.show()}.bind(this))}.bind(this))},messageConfirm:function messageConfirm(a){return c.get_strings([{key:a.title,component:a.component},{key:a.message,component:a.component}]).then(function(a){d.create({title:a[0],type:d.types.SAVE_CANCEL,body:a[1]}).done(function(a){this.modal=a;a.setSaveButtonText("Ok");a.show();b(".btn-primary").css("display","none")}.bind(this))}.bind(this))}}});
//# sourceMappingURL=newdepartment.min.js.map
