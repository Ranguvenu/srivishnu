define(["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui"],function(t,o,e,n,i,s,c){var r=function(t){this.contextid=t.contextid,this.child=t.child,this.costcenterid=t.costcenterid,this.parentid=t.parentid;this.init(t.selector)};return r.prototype.modal=null,r.prototype.contextid=-1,r.prototype.init=function(i){var s=this,c=t(this).data("value");if(c&&(s.costcenterid=c),s.child)var r=o.get_string("editchildcostcen","local_costcenter");else if(s.costcenterid)r=o.get_string("editcostcen","local_costcenter");else r=o.get_string("adnewcostcenter","local_costcenter");return r.then(function(t){return e.create({type:e.types.DEFAULT,title:t,body:s.getBody(),footer:this.getFooter()})}.bind(s)).then(function(o){return s.modal=o,s.modal.getRoot().addClass("openLMStransition local_costcenter"),s.modal.setLarge(),this.modal.getRoot().on(n.hidden,function(){o.destroy()}.bind(this)),this.modal.getFooter().find('[data-action="save"]').on("click",this.submitForm.bind(this)),this.modal.getFooter().find('[data-action="cancel"]').on("click",function(){window.location.href=window.location.href}),this.modal.getFooter().find('[data-action="skip"]').on("click",function(){s.args.form_status=s.args.form_status+1;var t=s.getBody();o.setBody(t)}),this.modal.getRoot().on("submit","form",function(t){s.submitFormAjax(t,s.args)}),this.modal.show(),this.modal.getRoot().animate({right:"0%"},500),t(".close").click(function(){window.location.href=window.location.href}),this.modal}.bind(this))},r.prototype.getBody=function(t){if(void 0===t&&(t={}),this.child)var o={costcenterid:this.costcenterid,jsonformdata:JSON.stringify(t),parentid:this.parentid,child:this.child};else o={costcenterid:this.costcenterid,jsonformdata:JSON.stringify(t),parentid:this.parentid};return i.loadFragment("local_costcenter","new_costcenterform",this.contextid,o)},r.prototype.getFooter=function(){return console.log(this),this.costcenterid?$footer='<button type="button" class="btn btn-primary" data-action="save">Update</button>&nbsp;':$footer='<button type="button" class="btn btn-primary" data-action="save">Create</button>&nbsp;',0==this.form_status&&($style='style="display:none;"',$footer+='<button type="button" class="btn btn-secondary" data-action="skip" '+$style+">Skip</button>&nbsp;"),$footer+='<button type="button" class="btn btn-secondary" data-action="cancel">Cancel</button>',$footer},r.prototype.handleFormSubmissionResponse=function(){this.modal.hide(),c.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),document.location.reload()},r.prototype.handleFormSubmissionFailure=function(t){this.modal.setBody(this.getBody(t))},r.prototype.submitFormAjax=function(t){t.preventDefault();var o=this.modal.getRoot().find("form").serialize();s.call([{methodname:"local_costcenter_submit_costcenterform_form",args:{contextid:this.contextid,jsonformdata:JSON.stringify(o)},done:this.handleFormSubmissionResponse.bind(this,o),fail:this.handleFormSubmissionFailure.bind(this,o)}])},r.prototype.submitForm=function(t){t.preventDefault();this.modal.getRoot().find("form").submit()},{init:function(t){return new r(t)},load:function(){},costcenterStatus:function(t){e.create({title:t.actionstatus,type:e.types.SAVE_CANCEL,body:t.actionstatusmsg}).done(function(o){this.modal=o,o.setSaveButtonText("Confirm"),o.getRoot().on(n.save,function(o){o.preventDefault(),t.confirm=!0,s.call([{methodname:"local_costcenter_status_confirm",args:t}])[0].done(function(t){window.location.href=window.location.href}).fail(function(t){})}.bind(this)),o.show()}.bind(this))}}});