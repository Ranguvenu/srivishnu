{"version":3,"sources":["../src/fragment.js"],"names":["define","$","Str","ModalFactory","ModalEvents","fragment","Ajax","Y","Templates","Notification","SELECTORS","ELEMENT","DATAATTRIBUTES","ELEFG","PLUGIN","METHOD","PARAMS","Fragment","fgelement","contextid","M","cfg","id","data","pluginname","method","level","args","params","JSON","stringify","init","prototype","strings","self","stringsPromise","getStrings","type","types","SAVE_CANCEL","DEFAULT","modalPromise","create","when","then","modal","setTitle","getRoot","on","hidden","destroy","bind","setBody","save","deleteInstance","getBody","setLarge","submitForm","submitFormAjax","setSaveButtonText","show","bodyRendered","parse","itemid","evalid","promise","call","methodname","typ","done","resp","html","formdata","fail","alert","addClass","animate","setTimeout","StringData","requiredStrings","RequiredStrings","i","each","key","value","component","param","get_strings","jsonformdata","loadFragment","handleFormSubmissionResponse","hide","use","core_formchangechecker","reset_form_dirty_state","document","location","reload","handleFormSubmissionFailure","e","preventDefault","formData","find","serialize","nextstep","submit","handleSubmissionResponse","error","handleSubmissionFailure","addNotification","message","trigger","PluginModule","require","split","le_createnewquestion","le_create","le_updatequestion","le_update","confirm","localparams","evalstatus","eval_status","evalname","published","hideevaluation","showevaluation","courseconfirm","coursename","coursestatus","disablecourse","enablecourse","callFragment"],"mappings":"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","sourcesContent":["/**\n * Add a create new group modal to the page.\n *\n * @module     local_courses/courseAjaxform\n * @class      courseAjaxform\n * @package    local_courses\n * @copyright  2018 Sreenivas\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'core/str',\n        'core/modal_factory',\n        'core/modal_events',\n        'core/fragment',\n        'core/ajax',\n        'core/yui',\n        'core/templates',\n        'core/notification',\n        'core/custom_interaction_events',\n        /*'local_kpi/smarttable'*/],\n        function($, Str, ModalFactory, ModalEvents, fragment, Ajax, Y, Templates, Notification, CustomEvents/*, Smarttable*/) {\n        var SELECTORS = {\n            ELEMENT: '[data-fg]',\n        };\n        var DATAATTRIBUTES = {\n            ELEFG: 'fg',\n            PLUGIN: 'plugin',\n            METHOD: 'method',\n            PARAMS: 'params'\n        }\n        var Fragment = function(fgelement) {\n            this.contextid = M.cfg.contextid;\n            this.fgelement = fgelement;\n            this.id = fgelement.data('id') || 0;\n            this.pluginname = fgelement.data(DATAATTRIBUTES.PLUGIN);\n            this.method = fgelement.data(DATAATTRIBUTES.METHOD);\n            this.level = fgelement.data(DATAATTRIBUTES.ELEFG);\n            this.args = {};\n            this.args.contextid = this.contextid;\n            this.args.id = this.id;\n            var params = {};\n            if (typeof fgelement.data(DATAATTRIBUTES.PARAMS) !== 'undefined') {\n                params = fgelement.data(DATAATTRIBUTES.PARAMS);\n            }\n            this.args.params = JSON.stringify(params);\n            this.init();\n        };\n\n        Fragment.prototype.contextid = -1;\n\n        Fragment.prototype.id = 0;\n\n        Fragment.prototype.level = 'c';\n\n        Fragment.prototype.strings = {};\n\n        Fragment.prototype.args = {};\n\n        Fragment.prototype.init = function () {\n            var self = this;\n            var stringsPromise = this.getStrings();\n            var type = ModalFactory.types.SAVE_CANCEL;\n            if (self.level == 'r') {\n                type = ModalFactory.types.DEFAULT;\n            }\n            var modalPromise = ModalFactory.create({\n                type: type\n            });\n            $.when(stringsPromise, modalPromise).then(function(strings, modal) {\n                // Keep a reference to the modal.\n                this.modal = modal;\n\n                this.modal.setTitle(strings[0]);\n                // Forms are big, we want a big modal.\n\n                // We want to reset the form every time it is opened.\n                this.modal.getRoot().on(ModalEvents.hidden, function() {\n                    this.modal.destroy();\n                }.bind(this));\n\n                if (self.level == 'd') {\n                    this.modal.setBody(strings[1]);\n                    this.modal.getRoot().on(ModalEvents.save, function() {\n                        self.deleteInstance();\n                    });\n                } else {\n                    this.modal.setBody(this.getBody());\n                    this.modal.setLarge();\n                    // We catch the modal save event, and use it to submit the form inside the modal.\n                    // Triggering a form submission will give JS validation scripts a chance to check for errors.\n                    this.modal.getRoot().on(ModalEvents.save, this.submitForm.bind(this));\n                    // We also catch the form submit event and use it to submit the form with ajax.\n                    this.modal.getRoot().on('submit', 'form', this.submitFormAjax.bind(this));\n                }\n                if(self.method == 'evaluation_update_status' || self.method == 'course_update_status'){\n                    this.modal.setSaveButtonText(strings[0]);\n                }else if(self.level != 'r'){\n                    this.modal.setSaveButtonText(strings[1]);\n                }\n                \n\n                // return this.modal;\n                this.modal.show();\n                // modal.getRoot().click(function(e) {\n                //     e.preventDefault();\n                //     // alert('here');\n                //     this.modal.show();\n                // }.bind(this));\n                this.modal.getRoot().on(ModalEvents.bodyRendered, function() {\n                    if (self.level == 'r' && (self.method == 'peer_allocation_status' || self.method == 'peer_badge_status')){\n                        // Smarttable.init();\n                    }else if(self.level == 'u' && self.method == 'addnew_question'){\n                        var params = JSON.parse(this.args.params);\n                        var itemid = params.itemid;\n                        var evalid = params.evalid;\n                        var promise = Ajax.call([{\n                            methodname: 'local_evaluation_displayquestion',\n                            args: {\n                                itemid: itemid,\n                                evalid: evalid,\n                                typ:0\n                            },\n                            }]);\n                        promise[0].done(function(resp) {\n                                $('#displayform').html(resp.formdata);\n                        }).fail(function() {\n                            // do something with the exception\n                            alert('Error occured while processing request');\n                            // window.location.reload();\n                        });\n                        $('#select_question_type_survey').addClass('hidden');\n                    }\n                }.bind(this));\n                if((self.level == 'c' || self.level == 'u') && self.method != 'evaluation_update_status'){\n                    self.modal.getRoot().addClass('openLMStransition costcenter');\n                    this.modal.getRoot().animate({\"right\":\"0%\"}, 500);\n                    this.modal.getRoot().on(ModalEvents.hidden, function() {\n                    //this.modal.destroy();\n                    this.modal.getRoot().animate({\"right\":\"-85%\"}, 500);\n                    setTimeout(function(){\n                    modal.destroy();\n                    }, 1000);\n                    }.bind(this));\n                }\n            }.bind(this));\n        };\n        /**\n         * [getStrings description]\n         * @method getStrings\n         * @param  {[type]}   StringData [description]\n         * @return {[type]}              [description]\n         */\n        Fragment.prototype.getStrings = function() {\n            var self = this;\n            var StringData = this.requiredStrings();\n            var RequiredStrings = [];\n            var i = 0;\n            $.each (StringData, function(key, value) {\n                RequiredStrings[i] = {key: key, component: self.pluginname, param: value};\n                i++;\n            });\n            var stringsPromise = Str.get_strings(RequiredStrings);\n            return stringsPromise;\n        };\n\n        /**\n         * @method getBody\n         * @private\n         * @return {Promise}\n         */\n        Fragment.prototype.getBody = function(formdata) {\n            if (typeof formdata === \"undefined\") {\n                formdata = {};\n            }\n            // Get the content of the modal.\n            this.args.jsonformdata = JSON.stringify(formdata);\n            return fragment.loadFragment(this.pluginname, this.method, this.contextid, this.args);\n        };\n\n        /**\n         * @method handleFormSubmissionResponse\n         * @private\n         * @return {Promise}\n         */\n        Fragment.prototype.handleFormSubmissionResponse = function() {\n            this.modal.hide();\n            // We could trigger an event instead.\n            // Yuk.\n            Y.use('moodle-core-formchangechecker', function() {\n                M.core_formchangechecker.reset_form_dirty_state();\n            });\n            // if(this.method == 'create_badge') {\n            //     var params = JSON.parse(this.args.params);\n            //     var badgetype = params.badgetype;\n            //     var accountid = params.accountid;\n            //     if(typeof badgetype == 'undefined'){\n            //         var formcontent = this.modal.getRoot().find('form').serializeArray();\n            //         var accountid = '';\n            //         var badgetype = '';\n            //         $.each(formcontent, function() {\n            //             if(this.name == 'costcenterid'){\n            //                 accountid = this.value;\n            //             }else if(this.name == 'type'){\n            //                 badgetype = this.value;\n            //             }\n            //         });\n            //         $(\"#badgeaccountselect\").val(accountid);\n            //         var element = $(\".nav-item.badgetype\");\n            //         $.each(element, function(){\n            //             $(this).data('accountid', accountid);\n            //         });\n            //         $('.gamificationtab').removeClass('active');\n            //         $(\"[data-badgetype='\"+badgetype+\"'] .gamificationtab\").addClass('active');\n            //         // var badgedefault = $(\".nav-item.badgetype .active\").parent();\n            //         // var badgetype = badgedefault.data('badgetype');\n            //         // var accountid = badgedefault.data('accountid');\n            //     }\n            //     $.ajax({\n            //         method: \"POST\",\n            //         dataType: \"json\",\n            //         url:M.cfg.wwwroot+\"/blocks/gamification/customajax.php\",\n            //         data: {action: \"get_badge_table\", accountid: accountid, type: badgetype},\n            //         success: function(data){\n            //             $('#badge_content').html(data);\n            //         }\n            //     });\n            // } else if(this.method == 'award_peer_badge'){\n                \n            // } else {\n                document.location.reload();\n            // }\n        };\n\n        /**\n         * @method handleFormSubmissionFailure\n         * @private\n         * @return {Promise}\n         */\n        Fragment.prototype.handleFormSubmissionFailure = function(data) {\n            // Oh noes! Epic fail :(\n            // Ah wait - this is normal. We need to re-display the form with errors!\n            this.modal.setBody(this.getBody(data));\n        };\n\n        /**\n         * Private method\n         *\n         * @method submitFormAjax\n         * @private\n         * @param {Event} e Form submission event.\n         */\n        Fragment.prototype.submitFormAjax = function(e) {\n            // We don't want to do a real form submission.\n            e.preventDefault();\n            var self = this;\n            // Convert all the form elements values to a serialised string.\n            var formData = this.modal.getRoot().find('form').serialize();\n            this.args.jsonformdata = JSON.stringify(formData);\n            // Now we can continue...\n            var promise = Ajax.call([{\n                methodname: this.pluginname + '_' + this.method,\n                args: this.args,\n                // done: this.handleFormSubmissionResponse.bind(this, formData),\n                // fail: this.handleFormSubmissionFailure.bind(this, formData)\n            }]);\n             promise[0].done(function(resp){\n                if (resp.nextstep) {\n                    self.modal.destroy();\n                    self.args.id = resp.id;\n                    self.init(self.fgelement);\n                    self.method = resp.method;\n                } else {\n                    // self.modal.destroy();\n                    // window.location.reload();\n                self.handleFormSubmissionResponse(formData);\n                }\n            }).fail(function(ex){\n                self.handleFormSubmissionFailure(formData);\n            });\n        };\n\n        /**\n         * This triggers a form submission, so that any mform elements can do final tricks before the form submission is processed.\n         *\n         * @method submitForm\n         * @param {Event} e Form submission event.\n         * @private\n         */\n        Fragment.prototype.submitForm = function(e) {\n            e.preventDefault();\n            this.modal.getRoot().find('form').submit();\n        };\n\n        Fragment.prototype.deleteInstance = function() {\n            var self = this;\n            Ajax.call([{\n                methodname: this.pluginname + '_' + this.method,\n                args: this.args\n            }])[0].done(function(data){\n                self.handleSubmissionResponse(data);\n            }).fail(function(error){\n                self.handleSubmissionFailure(error);\n            });\n        };\n        /**\n         * @method handleFormSubmissionResponse\n         * @private\n         * @return {Promise}\n         */\n        Fragment.prototype.handleSubmissionResponse = function() {\n            this.modal.destroy();\n            Notification.addNotification({\n                message: 'Success',\n                type: \"success\"\n            });\n            if(this.method == 'evaluation_update_status' || this.method == 'course_update_status'){\n                $('form#filteringform.mform #id_filter_apply').trigger('click');\n            }\n        };\n\n        /**\n         * @method handleFormSubmissionFailure\n         * @private\n         * @return {Promise}\n         */\n        Fragment.prototype.handleSubmissionFailure = function(error) {\n            this.modal.destroy();\n            Notification.addNotification({\n                message: error.message,\n                type: \"error\"\n            });\n        };\n\n        Fragment.prototype.requiredStrings = function() {\n            var StringData = {};\n            var PluginModule = require(this.pluginname  + '/' + this.pluginname.split('_')[1]);\n            if (typeof PluginModule.requiredStrings === 'function') {\n                StringData = PluginModule.requiredStrings(this);\n            }\n            switch (this.method) {\n                case 'addnew_question':\n                    switch(this.level){\n                        case 'c':\n                            StringData.le_createnewquestion = 'le_createnewquestion';\n                            StringData.le_create = 'le_create';\n                        break;\n                        case 'u':\n                            StringData.le_updatequestion = 'le_updatequestion';\n                            StringData.le_update = 'le_update';\n                        break;\n                    }\n                break;\n                case 'evaluation_update_status':\n                    StringData.confirm = '';\n                    var localparams = JSON.parse(this.args.params);\n                    var evalstatus = localparams.eval_status;\n                    var evalname = localparams.evalname;\n                    var published = localparams.published;\n                    // if(published == 0){\n                    //     StringData.publishevaluation = evalname;\n                    // }else{\n                        if(evalstatus == 1){\n                            StringData.hideevaluation = evalname;\n                        }else{\n                            StringData.showevaluation = evalname;\n                        }\n                    // }\n                break;\n                case 'course_update_status':\n                    StringData.courseconfirm = '';\n                    var localparams = JSON.parse(this.args.params);\n                    var coursename = localparams.coursename;\n                    var coursestatus = localparams.coursestatus\n                    if(coursestatus == 1){\n                        StringData.disablecourse = coursename;\n                    }else{\n                        StringData.enablecourse = coursename;\n\n                    }\n                break; \n                default:\n                break;\n            }\n            this.strings = StringData;\n            return StringData;\n        };\n    return {\n        init: function() {\n            $(document).on('click', SELECTORS.ELEMENT, function(e) {\n                e.preventDefault();\n                var fgelement = $(this);\n                var callFragment = new Fragment(fgelement);\n            });\n        }\n    };\n});"],"file":"fragment.min.js"}