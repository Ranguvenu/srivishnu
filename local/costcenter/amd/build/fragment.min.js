define ("local_costcenter/fragment",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","core/templates","core/notification","core/custom_interaction_events"],function(a,b,c,d,e,f,g,h,i){var j={ELEMENT:"[data-fg]"},k={ELEFG:"fg",PLUGIN:"plugin",METHOD:"method",PARAMS:"params"},l=function(a){this.contextid=M.cfg.contextid;this.fgelement=a;this.id=a.data("id")||0;this.pluginname=a.data(k.PLUGIN);this.method=a.data(k.METHOD);this.level=a.data(k.ELEFG);this.args={};this.args.contextid=this.contextid;this.args.id=this.id;var b={};if("undefined"!=typeof a.data(k.PARAMS)){b=a.data(k.PARAMS)}this.args.params=JSON.stringify(b);this.init()};l.prototype.contextid=-1;l.prototype.id=0;l.prototype.level="c";l.prototype.strings={};l.prototype.args={};l.prototype.init=function(){var b=this,e=this.getStrings(),g=c.types.SAVE_CANCEL;if("r"==b.level){g=c.types.DEFAULT}var h=c.create({type:g});a.when(e,h).then(function(c,e){this.modal=e;this.modal.setTitle(c[0]);this.modal.getRoot().on(d.hidden,function(){this.modal.destroy()}.bind(this));if("d"==b.level){this.modal.setBody(c[1]);this.modal.getRoot().on(d.save,function(){b.deleteInstance()})}else{this.modal.setBody(this.getBody());this.modal.setLarge();this.modal.getRoot().on(d.save,this.submitForm.bind(this));this.modal.getRoot().on("submit","form",this.submitFormAjax.bind(this))}if("evaluation_update_status"==b.method||"course_update_status"==b.method){this.modal.setSaveButtonText(c[0])}else if("r"!=b.level){this.modal.setSaveButtonText(c[1])}this.modal.show();this.modal.getRoot().on(d.bodyRendered,function(){if("r"==b.level&&("peer_allocation_status"==b.method||"peer_badge_status"==b.method)){}else if("u"==b.level&&"addnew_question"==b.method){var c=JSON.parse(this.args.params),d=c.itemid,e=c.evalid,g=f.call([{methodname:"local_evaluation_displayquestion",args:{itemid:d,evalid:e,typ:0}}]);g[0].done(function(b){a("#displayform").html(b.formdata)}).fail(function(){alert("Error occured while processing request")});a("#select_question_type_survey").addClass("hidden")}}.bind(this));if(("c"==b.level||"u"==b.level)&&"evaluation_update_status"!=b.method){b.modal.getRoot().addClass("openLMStransition costcenter");this.modal.getRoot().animate({right:"0%"},500);this.modal.getRoot().on(d.hidden,function(){this.modal.getRoot().animate({right:"-85%"},500);setTimeout(function(){e.destroy()},1e3)}.bind(this))}}.bind(this))};l.prototype.getStrings=function(){var c=this,d=this.requiredStrings(),e=[],f=0;a.each(d,function(a,b){e[f]={key:a,component:c.pluginname,param:b};f++});var g=b.get_strings(e);return g};l.prototype.getBody=function(a){if("undefined"==typeof a){a={}}this.args.jsonformdata=JSON.stringify(a);return e.loadFragment(this.pluginname,this.method,this.contextid,this.args)};l.prototype.handleFormSubmissionResponse=function(){this.modal.hide();g.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()});document.location.reload()};l.prototype.handleFormSubmissionFailure=function(a){this.modal.setBody(this.getBody(a))};l.prototype.submitFormAjax=function(a){a.preventDefault();var b=this,c=this.modal.getRoot().find("form").serialize();this.args.jsonformdata=JSON.stringify(c);var d=f.call([{methodname:this.pluginname+"_"+this.method,args:this.args}]);d[0].done(function(a){if(a.nextstep){b.modal.destroy();b.args.id=a.id;b.init(b.fgelement);b.method=a.method}else{b.handleFormSubmissionResponse(c)}}).fail(function(){b.handleFormSubmissionFailure(c)})};l.prototype.submitForm=function(a){a.preventDefault();this.modal.getRoot().find("form").submit()};l.prototype.deleteInstance=function(){var a=this;f.call([{methodname:this.pluginname+"_"+this.method,args:this.args}])[0].done(function(b){a.handleSubmissionResponse(b)}).fail(function(b){a.handleSubmissionFailure(b)})};l.prototype.handleSubmissionResponse=function(){this.modal.destroy();i.addNotification({message:"Success",type:"success"});if("evaluation_update_status"==this.method||"course_update_status"==this.method){a("form#filteringform.mform #id_filter_apply").trigger("click")}};l.prototype.handleSubmissionFailure=function(a){this.modal.destroy();i.addNotification({message:a.message,type:"error"})};l.prototype.requiredStrings=function(){var a={},b=require(this.pluginname+"/"+this.pluginname.split("_")[1]);if("function"==typeof b.requiredStrings){a=b.requiredStrings(this)}switch(this.method){case"addnew_question":switch(this.level){case"c":a.le_createnewquestion="le_createnewquestion";a.le_create="le_create";break;case"u":a.le_updatequestion="le_updatequestion";a.le_update="le_update";break;}break;case"evaluation_update_status":a.confirm="";var c=JSON.parse(this.args.params),d=c.eval_status,e=c.evalname,f=c.published;if(1==d){a.hideevaluation=e}else{a.showevaluation=e}break;case"course_update_status":a.courseconfirm="";var c=JSON.parse(this.args.params),g=c.coursename,h=c.coursestatus;if(1==h){a.disablecourse=g}else{a.enablecourse=g}break;default:break;}this.strings=a;return a};return{init:function init(){a(document).on("click",j.ELEMENT,function(b){b.preventDefault();var c=a(this),d=new l(c)})}}});
//# sourceMappingURL=fragment.min.js.map
