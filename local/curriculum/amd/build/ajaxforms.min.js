define(["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","core/templates"],function(e,t,o,a,s,c,r,n,l){var i=function(e){this.contextid=e.contextid,this.args=e,this.init(e)};return i.prototype.modal=null,i.prototype.contextid=-1,i.prototype.init=function(s){console.log(s);var c=this;switch(s.callback){case"curriculum_form":switch(s.id){case 0:header_label="createcurriculum";break;default:header_label="updatecurriculum"}break;case"session_form":switch(s.id){case 0:header_label="addsession";break;default:header_label="updatesession"}break;case"course_form":switch(s.id){case 0:header_label="addcourses";break;default:header_label="updatecourses"}break;case"program_manageprogram_form":switch(s.id){case 0:header_label="addprogram";break;default:header_label="updateprogram"}break;case"curriculum_completion_form":header_label="curriculum_completion_settings";break;case"curriculum_managesemester_form":switch(s.id){case 0:header_label="addsemester";break;default:header_label="editsemester"}break;case"curriculum_manageyear_form":switch(s.id){case 0:header_label="addyear";break;default:header_label="updateyear"}break;case"course_form":header_label="addcourse";break;case"curriculum_managefaculty_form":header_label="addfaculty";break;case"curriculum_managestudent_form":header_label="addstudent";break;case"curriculum_setyearcost_form":header_label="setcost"}return t.get_string(header_label,"local_curriculum").then(function(e){return o.create({type:o.types.DEFAULT,title:e,body:this.getBody(),footer:this.getFooter()})}.bind(this)).then(function(t){return this.modal=t,this.modal.setLarge(),this.modal.getRoot().addClass("openLMStransition local_curriculum"),this.modal.getRoot().on(a.hidden,function(){t.destroy()}.bind(this)),this.modal.getFooter().find('[data-action="save"]').on("click",this.submitForm.bind(this)),this.modal.getFooter().find('[data-action="cancel"]').on("click",function(){window.location.href=window.location.href}),this.modal.getFooter().find('[data-action="skip"]').on("click",function(){c.args.form_status=c.args.form_status+1,s.callback;var e=c.getBody();t.setBody(e)}),this.modal.getRoot().on("submit","form",function(e){c.submitFormAjax(e,c.args)}),this.modal.show(),this.modal.getRoot().animate({right:"0%"},500),e(".close").click(function(){window.location.href=window.location.href}),this.modal}.bind(this))},i.prototype.getBody=function(e){return void 0===e&&(e={}),this.args.jsonformdata=JSON.stringify(e),s.loadFragment(this.args.component,this.args.callback,this.contextid,this.args)},i.prototype.getFooter=function(){return"course_form"==this.args.callback?$footer='<button type="button" class="btn btn-primary" data-action="save">Assign</button>&nbsp;':(this.args.id?$footer='<button type="button" class="btn btn-primary" data-action="save">Update</button>&nbsp;':$footer='<button type="button" class="btn btn-primary" data-action="save">Create</button>&nbsp;',0==this.args.form_status&&($style='style="display:none;"',$footer+='<button type="button" class="btn btn-secondary" data-action="skip" '+$style+">Skip</button>&nbsp;")),$footer+='<button type="button" class="btn btn-secondary" data-action="cancel">Cancel</button>',$footer},i.prototype.handleFormSubmissionResponse=function(t){this.modal.hide(),r.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()});var o=this.args,a=o.semesterid;if("curriculum_addyear"==o.pluginname)var s=o.id;else s=o.yearid;o.yearid?e.ajax({method:"POST",url:M.cfg.wwwroot+"/local/curriculum/ajax.php",data:{action:"curriculumyearsemesters",curriculumid:o.curriculumid,yearid:s},success:function(t){e(".yearstabscontent_container").html(t),a?e(".tab-content .local_program-semisters_wrap #lpcourse_content"+a+" #semcollapse_"+a).hasClass("collapse")&&(e(".tab-content .local_program-semisters_wrap .lpcourse_content:first-child .courseslist").hasClass("collapse")&&(e(".tab-content .local_program-semisters_wrap .lpcourse_content:first-child .semcontentlist.semabove").addClass("collapsed"),e(".tab-content .local_program-semisters_wrap .lpcourse_content:first-child .courseslist").removeClass("collapse in").addClass("collapse")),e(".tab-content .local_program-semisters_wrap #lpcourse_content"+a+" #semcontentlist"+a).attr("aria-expanded","true"),e(".tab-content .local_program-semisters_wrap #lpcourse_content"+a+" #semcollapse_"+a).removeClass("collapse").addClass("collapse in")):e(".tab-content .local_program-semisters_wrap .lpcourse_content:first-child .courseslist").hasClass("collapse")&&e(".tab-content .local_program-semisters_wrap .lpcourse_content:first-child .courseslist").removeClass("collapse").addClass("collapse in")}}):document.location.reload()},i.prototype.handleFormSubmissionFailure=function(e){this.modal.setBody(this.getBody(e))},i.prototype.submitFormAjax=function(e,t){e.preventDefault();var o=this.modal.getRoot().find("form").serialize(),a=t.plugintype+"_"+t.pluginname+"_submit_data",s={};s.contextid=t.contextid,s.id=t.id,s.yearid=t.yearid,s.jsonformdata=JSON.stringify(o),c.call([{methodname:a,args:{contextid:this.contextid,jsonformdata:JSON.stringify(o)},done:this.handleFormSubmissionResponse.bind(this,o),fail:this.handleFormSubmissionFailure.bind(this,o)}])},i.prototype.submitForm=function(e){e.preventDefault(),this.modal.getRoot().find("form").submit()},ajaxforms={course_switch:function(t){if(e("#switch_course_"+t.courseid).is(":checked")){var o=1;checkbox_value=e("#switch_course_"+t.courseid).val()}else{o=0;checkbox_value=e("#switch_course_"+t.courseid).val()}e.ajax({type:"POST",url:M.cfg.wwwroot+"/local/curriculum/ajax.php?course="+checkbox_value+"&switch_type="+o,data:{action:""},success:function(t){console.log("came"),1==o?e("#notifycompletion"+checkbox_value).show():e("#notifycompletion"+checkbox_value).hide()},error:function(){},complete:function(){}})},init:function(e){return new i(e)},load:function(){e(document).on("change","#id_costcenter",function(){var t=e(this).find("option:selected").val();null!==t&&e.ajax({method:"GET",dataType:"json",url:M.cfg.wwwroot+"/local/users/ajax.php?action=departmentlist&costcenter="+t,success:function(t){var o="<option value=>--Select College--</option>";e.each(t.colleges,function(e,t){o+="<option value = "+t.id+" >"+t.fullname+"</option>"}),e("#id_open_collegeid").html(o);var a="<option value=0>--Select Department--</option>";e.each(t.departments,function(e,t){a+="<option value = "+t.id+" >"+t.fullname+"</option>"}),e("#id_open_departmentid").html(a)}})})},myDescFunction:function(){var e=document.getElementById("descriptiondotsBtn"),t=document.getElementById("resttextDisplay"),o=document.getElementById("readmoremyBtn");"none"===e.style.display?(e.style.display="inline",o.innerHTML="Read more",t.style.display="none"):(e.style.display="none",o.innerHTML="Read less",t.style.display="inline")},curriculumDatatable:function(t){params=[],params.action="viewcurriculums",params.curriculumstatus=t.curriculumstatus,e.ajax({type:"POST",url:M.cfg.wwwroot+"/local/curriculum/ajax.php",data:{action:"viewcurriculums",sesskey:M.cfg.sesskey}})},deleteConfirm:function(e){return t.get_strings([{key:"confirmation",component:"local_curriculum"},{key:"deleteconfirm",component:"local_curriculum",param:e.curriculumname},{key:"deleteallconfirm",component:"local_curriculum"},{key:"delete",component:"local_curriculum"},{key:"deletecourseconfirm",component:"local_curriculum"},{key:"cannotdeleteall",component:"local_curriculum"},{key:"cannotdeletesession",component:"local_curriculum"},{key:"cannotdeletesemester",component:"local_curriculum"},{key:"cannotdeletesemesteryear",component:"local_curriculum"},{key:"confirmunassignfaculty",component:"local_curriculum"}]).then(function(t){if("deletecurriculum"==e.action){t[1]=t[1];var s=o.types.SAVE_CANCEL}else if("deletecurriculumcourse"==e.action){t[1]=t[4];s=o.types.SAVE_CANCEL}else if("cannotdeletecurriculum"==e.action){t[1]=t[5];s=o.types.DEFAULT}else if("cannotdeletesession"==e.action){t[1]=t[6];s=o.types.DEFAULT}else if("cannotdeletesemester"==e.action){t[1]=t[7];s=o.types.DEFAULT}else if("cannotdeletesemesteryear"==e.action){t[1]=t[8];s=o.types.DEFAULT}else if("unassignfaculty"==e.action){t[1]=t[9];s=o.types.SAVE_CANCEL}else{t[1]=t[2];s=o.types.SAVE_CANCEL}o.create({title:t[0],type:s,body:t[1]}).done(function(o){this.modal=o,"cannotdeletecurriculum"!=e.action&&"cannotdeletesession"!=e.action&&"cannotdeletesemester"!=e.action&&"cannotdeletesemesteryear"!=e.action&&o.setSaveButtonText(t[3]),o.getRoot().on(a.save,function(t){t.preventDefault(),e.confirm=!0,c.call([{methodname:"local_curriculum_"+e.action,args:e}])[0].done(function(t){"deletecurriculum"==e.action?window.location.href=M.cfg.wwwroot+"/local/curriculum/index.php":window.location.href=M.cfg.wwwroot+"/local/curriculum/view.php?ccid="+e.curriculumid+"&type = 1"}).fail(function(e){console.log(e)})}.bind(this)),o.show()}.bind(this))}.bind(this))},unassignCourses:function(s){return console.log(s),t.get_strings([{key:"confirmation",component:"local_curriculum"},{key:"unassign_courses_confirm",component:"local_curriculum",param:s},{key:"unassign",component:"local_curriculum"},{key:"cannotunassign_courses_confirm",component:"local_curriculum"}]).then(function(t){if("unassign_course"==s.action){t[1]=t[1];var r=o.types.SAVE_CANCEL}else if("cannotunassign_course"==s.action){t[1]=t[3];r=o.types.DEFAULT}else{t[1]=t[1];r=o.types.SAVE_CANCEL}o.create({title:t[0],type:r,body:t[1]}).done(function(o){this.modal=o,"cannotunassign_course"!=s.action&&o.setSaveButtonText(t[2]),o.getRoot().on(a.save,function(t){t.preventDefault(),params={},params.programid=s.programid,params.curriculumid=s.curriculumid,params.semesterid=s.semesterid,params.yearid=s.yearid,params.courseid=s.courseid,c.call([{methodname:"local_curriculum_"+s.action,args:params}])[0].done(function(t){o.hide();var a=params.semesterid;e.ajax({method:"POST",url:M.cfg.wwwroot+"/local/curriculum/ajax.php",data:{action:"curriculumyearsemesters",curriculumid:params.curriculumid,yearid:params.yearid},success:function(t){e(".yearstabscontent_container").html(t),a?e(".tab-content .local_program-semisters_wrap #lpcourse_content"+a+" #semcollapse_"+a).hasClass("collapse")&&(e(".tab-content .local_program-semisters_wrap .lpcourse_content:first-child .courseslist").hasClass("collapse")&&(e(".tab-content .local_program-semisters_wrap .lpcourse_content:first-child .semcontentlist.semabove").addClass("collapsed"),e(".tab-content .local_program-semisters_wrap .lpcourse_content:first-child .courseslist").removeClass("collapse in").addClass("collapse")),e(".tab-content .local_program-semisters_wrap #lpcourse_content"+a+" #semcontentlist"+a).attr("aria-expanded","true"),e(".tab-content .local_program-semisters_wrap #lpcourse_content"+a+" #semcollapse_"+a).removeClass("collapse").addClass("collapse in")):e(".tab-content .local_program-semisters_wrap .lpcourse_content:first-child .courseslist").hasClass("collapse")&&e(".tab-content .local_program-semisters_wrap .lpcourse_content:first-child .courseslist").removeClass("collapse").addClass("collapse in")}})}).fail(function(e){console.log(e)})}.bind(this)),o.show()}.bind(this)),modal.show()}.bind(this))}}});