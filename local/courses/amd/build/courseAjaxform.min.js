define(["local_courses/jquery.dataTables","jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","core/templates"],function(t,o,e,n,i,s,a,c,r){var l=function(t){this.contextid=t.contextid||1,this.args=t,this.init(t)};return l.prototype.modal=null,l.prototype.contextid=-1,l.prototype.init=function(t){var o=this;if(t.courseid)if(1==t.forpurchaseindividually||2==t.forpurchaseindividually)var s=e.get_string("editcourse","local_mooccourses");else s=e.get_string("editcourse","local_courses");else s=e.get_string("createnewcourse","local_courses");return s.then(function(t){return n.create({type:n.types.DEFAULT,title:t,body:this.getBody(),footer:this.getFooter()})}.bind(this)).then(function(e){return this.modal=e,this.modal.setLarge(),this.modal.getRoot().addClass("openLMStransition local_courses"),this.modal.getRoot().on(i.hidden,function(){this.modal.getRoot().animate({right:"-85%"},500),setTimeout(function(){e.destroy()},1e3),this.modal.setBody("")}.bind(this)),this.modal.getFooter().find('[data-action="save"]').on("click",this.submitForm.bind(this)),this.modal.getFooter().find('[data-action="cancel"]').on("click",function(){e.setBody(""),e.hide(),setTimeout(function(){e.destroy()},1e3),0!==t.form_status&&window.location.reload()}),this.modal.getRoot().find('[data-action="hide"]').on("click",function(){e.hide(),setTimeout(function(){e.destroy()},1e3),0!==t.form_status&&window.location.reload()}),this.modal.getRoot().on("submit","form",function(t){o.submitFormAjax(t,o.args)}),this.modal.show(),this.modal.getRoot().animate({right:"0%"},500),this.modal}.bind(this))},l.prototype.getBody=function(t){return void 0===t&&(t={}),this.args.jsonformdata=JSON.stringify(t),s.loadFragment(this.args.component,this.args.callback,this.contextid,this.args)},l.prototype.getFooter=function(){return this.args.courseid?$footer='<button type="button" class="btn btn-primary" data-action="save">Update</button>&nbsp;':$footer='<button type="button" class="btn btn-primary" data-action="save">Create</button>&nbsp;',0==this.args.form_status&&($style='style="display:none;"',$footer+='<button type="button" class="btn btn-secondary" data-action="skip" '+$style+">Skip</button>&nbsp;"),$footer+='<button type="button" class="btn btn-secondary" data-action="cancel">Cancel</button>',$footer},l.prototype.getcontentFooter=function(){return $footer='<button type="button" class="btn btn-secondary" data-action="cancel">Cancel</button>',$footer},l.prototype.handleFormSubmissionResponse=function(t){this.modal.hide(),c.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),document.location.reload()},l.prototype.handleFormSubmissionFailure=function(t){this.modal.setBody(this.getBody(t))},l.prototype.submitFormAjax=function(t,o){t.preventDefault();var e=this.modal.getRoot().find("form").serialize(),n=o.plugintype+"_"+o.pluginname+"_submit_create_course_form",i={};i.contextid=this.contextid,i.jsonformdata=JSON.stringify(e),a.call([{methodname:n,args:i,done:this.handleFormSubmissionResponse.bind(this,e),fail:this.handleFormSubmissionFailure.bind(this,e)}])},l.prototype.submitForm=function(t){t.preventDefault(),this.modal.getRoot().find("form").submit()},{init:function(t){return new l(t)},deleteConfirm:function(t){return e.get_strings([{key:"confirmation",component:"local_courses"},{key:"deleteconfirm",component:"local_courses",param:t},{key:"deleteallconfirm",component:"local_courses"},{key:"delete"}]).then(function(o){var s=n.types.SAVE_CANCEL,c=o[1];if(t.count>0){t.count;s=n.types.CANCEL,c=e.get_string("coursevalidationbody","local_courses"),o[0]="Alert"}n.create({title:o[0],type:s,body:c}).done(function(e){this.modal=e,0==t.count&&(e.setSaveButtonText(o[3]),e.getRoot().on(i.save,function(o){o.preventDefault(),t.confirm=!0,a.call([{methodname:"local_courses_"+t.action,args:t}])[0].done(function(){window.location.href=window.location.href}).fail(function(t){console.log(t)})}.bind(this))),e.show()}.bind(this))}.bind(this))},userSuspend:function(t){return console.log(t),e.get_strings([{key:"confirmation",component:"local_courses"},{key:"suspendconfirm",component:"local_courses",param:t},{key:"suspendallconfirm",component:"local_courses"},{key:"confirm"}]).then(function(o){n.create({title:o[0],type:n.types.SAVE_CANCEL,body:o[1]}).done(function(e){this.modal=e,e.setSaveButtonText(o[3]),e.getRoot().on(i.save,function(o){o.preventDefault(),t.confirm=!0,console.log(t);var e={};e.id=t.id,e.contextid=t.contextid,a.call([{methodname:"local_courses_suspend_course",args:e}])[0].done(function(t){window.location.href=window.location.href}).fail(function(t){console.log(t)})}.bind(this)),e.show()}.bind(this))}.bind(this))},courseavailability:function(t){return console.log(t),e.get_strings([{key:"confirmation",component:"local_courses"},{key:"availiabilityofcourse",component:"local_courses",param:t},{key:"availiabilityofcourseconfirm",component:"local_courses"},{key:"confirm"}]).then(function(o){n.create({title:o[0],type:n.types.SAVE_CANCEL,body:o[1]}).done(function(e){this.modal=e,e.setSaveButtonText(o[3]),e.getRoot().on(i.save,function(o){o.preventDefault(),t.confirm=!0,console.log(t);var e={};e.id=t.id,e.contextid=t.contextid,a.call([{methodname:"local_courses_availability_course",args:e}])[0].done(function(t){window.location.href=window.location.href}).fail(function(t){console.log(t)})}.bind(this)),e.show()}.bind(this))}.bind(this))},getCatlist:function(){if(costcenter=o("#id_open_costcenterid").val(),""===costcenter){o("#id_open_departmentid").html("<option value=''>--Select Department--</option>");o("#id_category").html("<option value=''>--Select Department--</option>")}else{a.call([{methodname:"local_courses_departmentlist",args:{costcenter:costcenter}}])[0].done(function(t){var e="";departmentlist=JSON.parse(t.departmentlist),categorylist=JSON.parse(t.categorylist),o.each(categorylist,function(t,o){e+="<option value = "+o.id+" >"+o.name+"</option>"}),o("#id_category").html(e)}).fail(function(){alert("Error occured while processing request"),window.location.reload()})}},load:function(){}}});