{"version":3,"sources":["../src/team_approvals.js"],"names":["define","Str","ModalFactory","ModalEvents","Ajax","$","init","requestsearch","params","learningtype","changed_learningtype","val","search","searchvalue","target","ajax","type","url","M","cfg","wwwroot","success","data","html","select_learningtype","pluginname","select_request","requestid","coursecheckedstatus","element","checked","allocate","prop","approve_request","learning_type","requeststoapprove","each","requestid_selected","push","length","create","title","get_string","types","DEFAULT","body","done","modal","setSaveButtonText","show","getRoot","on","hidden","destroy","cancel","SAVE_CANCEL","save","hide","console","log","window","location","href","setTimeout"],"mappings":"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","sourcesContent":["/**\r\n * Add a create new group modal to the page.\r\n *\r\n * @module     core_group/AjaxForms\r\n * @class      AjaxForms\r\n * @package    core_group\r\n * @copyright  2017 Damyon Wiese <damyon@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine([\r\n    'core/str',\r\n    'core/modal_factory',\r\n    'core/modal_events',\r\n    'core/ajax',\r\n    'jquery',\r\n    'jqueryui'\r\n], function(Str, ModalFactory, ModalEvents, Ajax, $) {\r\n    var team_approvals;\r\n    return {\r\n        init: function() {\r\n\r\n        },\r\n        requestsearch: function(params) {\r\n            // console.log(params);\r\n            var learningtype = params.learningtype;\r\n\r\n            var changed_learningtype = $('input[name=\"approval_learning_type\"]').val();\r\n            if(changed_learningtype){\r\n                learningtype = changed_learningtype;\r\n            }\r\n            var search = params.searchvalue;\r\n            if(typeof(search) == 'undefined' || search == null){\r\n                return false;\r\n            }\r\n            if(learningtype == 'elearning'){\r\n                var target = '#team_requests_list';\r\n                \r\n                $.ajax({\r\n                    type: \"POST\",\r\n                    url: M.cfg.wwwroot + \"/local/users/team_actions/team_approvals_ajax.php?action=searchdata&learningtype=\"+learningtype+'&search='+search,\r\n                    // data: \"action=searchdata&type=\"+type+'&search='+search+'&learningtype='+learningtype+'&selectedcontent='+selectedcontent+'&user='+user,\r\n                    success: function(data) {\r\n                        $(target).html(data);\r\n                    }\r\n                });\r\n            }else{//learningtype = classroom\r\n                var target = '#team_requests_list';\r\n\r\n                $.ajax({\r\n                    type: \"POST\",\r\n                    url: M.cfg.wwwroot + \"/local/users/team_actions/team_approvals_ajax.php?action=searchdata&learningtype=\"+learningtype+'&search='+search,\r\n                    // data: \"action=searchdata&type=\"+type+'&search='+search+'&learningtype='+learningtype+'&selectedcontent='+selectedcontent+'&user='+user,\r\n                    success: function(data) {\r\n                        $(target).html(data);\r\n                    }\r\n                });\r\n            }\r\n        },\r\n        select_learningtype: function(params) {\r\n            var learningtype = params.learningtype;\r\n            var pluginname = params.pluginname;\r\n\r\n            $('input[name=\"approval_learning_type\"]').val(learningtype);\r\n            $('input[name=\"search_requests\"]').val('');\r\n            $('.team_learningtype_dropdown').html(pluginname);\r\n            var target = '#team_requests_list';\r\n            $.ajax({\r\n                    type: \"POST\",\r\n                    url: M.cfg.wwwroot + \"/local/users/team_actions/team_approvals_ajax.php?action=change_learningtype&learningtype=\"+learningtype,\r\n                    // data: \"action=searchdata&type=\"+type+'&search='+search+'&learningtype='+learningtype+'&selectedcontent='+selectedcontent+'&user='+user,\r\n                    success: function(data) {\r\n                        $(target).html(data);\r\n                    }\r\n                });\r\n        },\r\n        select_request: function(params) {\r\n            var learningtype = params.learningtype;\r\n            var requestid = params.requestid;\r\n            var coursecheckedstatus = params.element.checked;\r\n            var allocate = false;\r\n\r\n            if(requestid > 0){\r\n                if(coursecheckedstatus == true){\r\n                    allocate = true;\r\n                }\r\n            }\r\n\r\n            if(allocate == true){\r\n                $('.request_approval_btn').prop( \"disabled\", false);\r\n            }else{\r\n                $('.request_approval_btn').prop( \"disabled\", true);\r\n            }\r\n\r\n        },\r\n\r\n        approve_request: function() {\r\n            var learning_type = $('#approval_learning_type').val();\r\n            var requeststoapprove = [];\r\n\r\n            $('input[name=\"search_learningtypes\"]').val('');\r\n            $('input[name=\"team_requests[]\"]:checked').each(function () {\r\n                var requestid_selected = $(this).val();\r\n                requeststoapprove.push(requestid_selected);\r\n            });\r\n\r\n            // console.log(requeststoapprove);\r\n            if(!learning_type.length){\r\n                ModalFactory.create({\r\n                    title: Str.get_string('warning'),\r\n                    type: ModalFactory.types.DEFAULT,\r\n                    body: Str.get_string('select_learningtype', 'local_users')\r\n                }).done(function(modal) {\r\n                    modal.setSaveButtonText(Str.get_string('approve', 'local_users'));\r\n                    modal.show();\r\n                    modal.getRoot().on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n                    modal.getRoot().on(ModalEvents.cancel, function() {\r\n                        modal.destroy();\r\n                    });\r\n                });\r\n                return false;\r\n            }\r\n\r\n            if(!requeststoapprove.length){\r\n                ModalFactory.create({\r\n                    title: Str.get_string('warning'),\r\n                    type: ModalFactory.types.DEFAULT,\r\n                    body: Str.get_string('select_requests', 'local_users')\r\n                }).done(function(modal) {\r\n                    modal.setSaveButtonText(Str.get_string('approve', 'local_users'));\r\n                    modal.show();\r\n                    modal.getRoot().on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n                    modal.getRoot().on(ModalEvents.cancel, function() {\r\n                        modal.destroy();\r\n                    });\r\n                });\r\n                return false;\r\n            }\r\n\r\n            ModalFactory.create({\r\n                title: Str.get_string('confirm'),\r\n                type: ModalFactory.types.SAVE_CANCEL,\r\n                body: Str.get_string('team_request_confirm', 'local_users')\r\n            }).done(function(modal) {\r\n                modal.setSaveButtonText(Str.get_string('approve', 'local_users'));\r\n                modal.show();\r\n                modal.getRoot().on(ModalEvents.hidden, function() {\r\n                    modal.destroy();\r\n                });\r\n                modal.getRoot().on(ModalEvents.save, function() {\r\n                    $.ajax({\r\n                        type: \"POST\",\r\n                        data: '',\r\n                        url: M.cfg.wwwroot + \"/local/users/team_actions/team_approvals_ajax.php?action=requestapproved&learningtype=\"+learning_type+\"&requeststoapprove=\"+requeststoapprove,\r\n                        success: function (data) {\r\n                            $('#allocation_notifications').html('<div class=\"alert alert-info\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\">×</button>Selected learning types has been allocated.</div>');\r\n                            modal.hide();\r\n                            // setTimeout(function(){\r\n                                modal.destroy();\r\n                                console.log(data);\r\n                                window.location.href = window.location.href;\r\n                            // }, 5000);\r\n                        }\r\n                    });\r\n                });\r\n                modal.getRoot().on(ModalEvents.cancel, function() {\r\n                    setTimeout(function(){\r\n                        modal.destroy();\r\n                    }, 1000);\r\n                });\r\n                 //return modal;\r\n            });\r\n        }\r\n    };\r\n});\r\n"],"file":"team_approvals.min.js"}